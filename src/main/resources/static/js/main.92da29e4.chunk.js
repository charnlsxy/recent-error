(this["webpackJsonpstudy-cheese"]=this["webpackJsonpstudy-cheese"]||[]).push([[0],{272:function(e,t,n){"use strict";n.r(t);var a=n(57),r=n(58),s=n(62),i=n(61),l=n(0),o=n.n(l),c=n(25),u=n.n(c),d=(n(178),n(53)),h=n(24),m=n(277),j=n(48),b=n(283),f=n(6);var p=n(286),x=n(287),O=n(56),g=n(280),y=n(279),v=n(33),C=n(284),q=n(285),S=n(97),k=n(171),w=n(281),I=n(274),N=n(275),D=n(158),L=n.n(D).a.create({timeout:1e4,withCredentials:!0});L.interceptors.request.use((function(e){return e.baseURL="/err",e}),(function(e){return Promise.reject(e)})),L.interceptors.response.use((function(e){return e.data}),(function(e){var t=e.response,n=t?t.status:-1;console.log(e);var a=t?t.data:null;return 400===n&&a?Promise.reject(a):(k.a.error({message:t.statusText}),Promise.reject(e))}));var V=L,M="/mysql",P={testConn:function(e){return V({url:"".concat(M,"/test"),params:e,method:"post"})},saveConn:function(e,t){return V({url:"".concat(M,"/saveConn"),data:t,params:{name:e},method:"post"})},saveSql:function(e){return V({url:"".concat(M,"/saveSql"),data:e,method:"post"})},allConn:function(){return V({url:"".concat(M,"/allConn"),method:"get"})},allSql:function(){return V({url:"".concat(M,"/allSql"),method:"get"})},findSqlArgById:function(e){return V({url:"".concat(M,"/sqlArg"),params:{sqlId:e},method:"get"})},execSql:function(e,t){return V({url:"".concat(M,"/exec"),params:{id:e},data:t,method:"post"})},history:function(){return V({url:"".concat(M,"/history"),method:"get"})},deleteHistory:function(){return V({url:"".concat(M,"/history"),method:"delete"})}},A=P,B=g.a.TextArea,F=S.a.Option,H=[{val:1,name:"string"},{val:2,name:"int"}],E=function(e){Object(s.a)(n,e);var t=Object(i.a)(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,e)).form=o.a.createRef(),r.testConn=function(){A.testConn(r.data).then((function(){return k.a.success({message:"\u8fde\u63a5\u6210\u529f"})})).catch((function(e){console.log(e),k.a.error({message:"\u8fde\u63a5\u5931\u8d25",description:e.err})}))},r.saveConn=function(e){return A.saveConn(e,r.data).then((function(e){var t=r.state.existDb;t.push(e),r.setState({existDb:t}),r.changeConn(e.id),r.form.current.setFieldsValue({sql:{dbConnId:e.id}}),k.a.success({message:"\u4fdd\u5b58\u6210\u529f"})})).catch((function(e){k.a.error({message:"\u4fdd\u5b58\u5931\u8d25",description:e.err})}))},r.state={inputConnNameModalVisible:!1,inputQueryNameModalVisible:!1,existConnLoading:!0,existDb:[]},r.data={username:"",password:"",host:"",database:""},r.sqlParam=[],r.sql="",r.connName="",r.queryName="",r.formData={},r}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this;A.allConn().then((function(t){e.setState({existDb:t})})).catch((function(e){return console.log(e)})).finally((function(){return e.setState({existConnLoading:!1})}))}},{key:"openConnDialog",value:function(){this.setState({inputConnNameModalVisible:!0})}},{key:"closeConnDialog",value:function(){this.setState({inputConnNameModalVisible:!1}),this.connName=""}},{key:"confirmInputModal",value:function(){this.saveConn(this.connName),this.setState({inputConnNameModalVisible:!1})}},{key:"confirmQueryModal",value:function(){this.setState({inputQueryNameModalVisible:!1}),this.formData.name=this.queryName,A.saveSql(this.formData).then((function(){return k.a.info({message:"\u6210\u529f"})})).catch((function(e){return k.a.error({message:e.err})}))}},{key:"addParam",value:function(e){this.sqlParam.push({name:"",type:""}),e()}},{key:"changeConn",value:function(e){var t=this.state.existDb.find((function(t){return t.id===e}));t&&(console.log(t),this.form.current.setFieldsValue(t),this.data=t)}},{key:"render",value:function(){var e=this;return Object(f.jsxs)(y.a,Object(O.a)(Object(O.a)({},{labelCol:{span:4},wrapperCol:{span:16}}),{},{name:"nest-messages",onFinish:function(t){e.formData=t.sql,e.setState({inputQueryNameModalVisible:!0})},ref:this.form,validateMessages:{required:"${label} is required!",types:{email:"${label} is not a valid email!",number:"${label} is not a valid number!"},number:{range:"${label} must be between ${min} and ${max}"}},children:[Object(f.jsx)(y.a.Item,{style:{marginBottom:"1px"},name:["host"],label:"host",rules:[{required:!0}],children:Object(f.jsx)(g.a,{onChange:function(t){return e.data.host=t.target.value}})}),Object(f.jsx)(y.a.Item,{style:{marginBottom:"1px"},name:["username"],label:"username",rules:[{required:!0}],children:Object(f.jsx)(g.a,{onChange:function(t){return e.data.username=t.target.value}})}),Object(f.jsx)(y.a.Item,{style:{marginBottom:"1px"},name:["password"],label:"password",rules:[{required:!0}],children:Object(f.jsx)(g.a,{type:"password",onChange:function(t){return e.data.password=t.target.value}})}),Object(f.jsx)(y.a.Item,{style:{marginBottom:"1px"},name:["database"],label:"database",rules:[{required:!0}],children:Object(f.jsx)(g.a,{onChange:function(t){return e.data.database=t.target.value}})}),Object(f.jsx)(y.a.Item,{style:{marginBottom:"1px"},name:["sql","dbConnId"],label:"\u9009\u62e9\u5b58\u5728\u7684\u6570\u636e\u5e93",children:Object(f.jsx)(S.a,{placeholder:"select db",loading:this.state.existConnLoading,style:{width:240},onChange:function(t){return e.changeConn(t)},children:this.state.existDb.map((function(e){return Object(f.jsx)(F,{value:e.id,children:e.name},e.id)}))})}),Object(f.jsx)(w.a,{title:"\u8fde\u63a5\u540d\u79f0",visible:this.state.inputConnNameModalVisible,onOk:function(){return e.confirmInputModal()},onCancel:function(){return e.closeConnDialog()},children:Object(f.jsx)(g.a,{onChange:function(t){return e.connName=t.target.value}})}),Object(f.jsxs)(I.a,{style:{marginBottom:"10px"},children:[Object(f.jsx)(N.a,{span:2,offset:4,children:Object(f.jsx)(v.a,{onClick:function(){return e.testConn()},children:"test conn"})}),Object(f.jsx)(N.a,{span:2,offset:2,children:Object(f.jsx)(v.a,{onClick:function(){return e.openConnDialog()},children:"save conn"})})]}),Object(f.jsx)(y.a.Item,{label:"param",children:Object(f.jsx)(y.a.List,{name:["sql","argList"],children:function(t,n,a){var r=n.add,s=n.remove,i=a.errors;return Object(f.jsxs)(f.Fragment,{children:[t.map((function(n,a){return Object(f.jsxs)(y.a.Item,{required:!0,children:[Object(l.createElement)(y.a.Item,Object(O.a)(Object(O.a)({},n),{},{noStyle:!0,name:[a,"argName"],key:n.key+"n"}),Object(f.jsx)(g.a,{onChange:function(t){return e.sqlParam[a].name=t.target.value},placeholder:"name",style:{width:"30%"}})),Object(l.createElement)(y.a.Item,Object(O.a)(Object(O.a)({},n),{},{noStyle:!0,name:[a,"type"],key:n.key+"t"}),Object(f.jsx)(S.a,{onChange:function(t){return e.sqlParam[a].type=t},placeholder:"type",style:{width:"16%",margin:"0 2px"},children:H.map((function(e){return Object(f.jsx)(F,{value:e.val,children:e.name},e.val)}))})),Object(l.createElement)(y.a.Item,Object(O.a)(Object(O.a)({},n),{},{noStyle:!0,name:[a,"argVal"],key:n.key+"d"}),Object(f.jsx)(g.a,{onChange:function(t){return e.sqlParam[a].val=t.target.value},placeholder:"default val",style:{width:"30%"}})),t.length>0?Object(f.jsx)(C.a,{style:{marginLeft:"10px"},className:"dynamic-delete-button",onClick:function(){return s(n.name)}}):null]},n.key)})),Object(f.jsxs)(y.a.Item,{children:[Object(f.jsx)(v.a,{type:"dashed",onClick:function(){return e.addParam(r)},style:{width:"30%",align:"center"},icon:Object(f.jsx)(q.a,{}),children:"Add Sql param"}),Object(f.jsx)(y.a.ErrorList,{errors:i})]})]})}})}),Object(f.jsx)(y.a.Item,{label:"sql",name:["sql","sql"],rules:[{required:!0}],children:Object(f.jsx)(B,{onChange:function(t){return e.sql=t.target.value},rows:10,showCount:!0,maxLength:100,style:{width:"100%"}})}),Object(f.jsx)(w.a,{title:"\u5b58\u50a8\u540d\u79f0",visible:this.state.inputQueryNameModalVisible,onOk:function(){return e.confirmQueryModal()},onCancel:function(){return e.setState({inputQueryNameModalVisible:!1})},children:Object(f.jsx)(g.a,{onChange:function(t){return e.queryName=t.target.value}})}),Object(f.jsx)(y.a.Item,{children:Object(f.jsx)(v.a,{type:"primary",htmlType:"submit",children:"Submit"})})]}))}}]),n}(o.a.Component),Q=n(278),$=n(282),T=n(276),R=function(e){Object(s.a)(n,e);var t=Object(i.a)(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,e)).form=o.a.createRef(),r.state={data:[]},r}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.loadHistory()}},{key:"loadHistory",value:function(){var e=this;A.history().then((function(t){console.log(t);var n=t.map((function(e){return{id:e.id,data:JSON.parse(e.content),time:e.time}}));e.setState({data:n})}))}},{key:"deleteAll",value:function(){var e=this;A.deleteHistory().then((function(){return e.loadHistory()}))}},{key:"render",value:function(){var e=this;return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsx)(v.a,{onClick:function(){return e.loadHistory()},children:"refresh"}),Object(f.jsx)(v.a,{onClick:function(){return e.deleteAll()},children:"delete all"}),this.state.data.map((function(e){return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)(T.a,{orientation:"left",plain:!0,children:[Object(f.jsx)("span",{style:{color:"#1890ff"},children:e.time})," : ",e.data.sql.name]}),Object(f.jsx)("p",{children:e.data.sql.sql})]})}))]})}}]),n}(o.a.Component),J=S.a.Option,_=function(e){Object(s.a)(n,e);var t=Object(i.a)(n);function n(e){var r;return Object(a.a)(this,n),(r=t.call(this,e)).form=o.a.createRef(),r.currentSelect="",r.argInfo={},r.state={data:[],columns:[],existSql:[],sqlLoading:!0,sqlList:[],sqlParam:[],tableLoading:!1,drawerVisible:!1},r}return Object(r.a)(n,[{key:"changeSql",value:function(e){var t=this;this.currentSelect=e,this.argInfo={},A.findSqlArgById(e).then((function(e){e.forEach((function(e){return t.argInfo[e.argName]=e.argVal})),t.form.current.setFieldsValue({arg:t.argInfo}),t.setState({sqlParam:e})}))}},{key:"execSql",value:function(){var e=this;this.setState({tableLoading:!0}),A.execSql(this.currentSelect,this.convertArg()).then((function(t){t&&e.setState({data:t,columns:e.buildColumn(t[0])})})).finally((function(){return e.setState({tableLoading:!1})}))}},{key:"buildColumn",value:function(e,t){var n=[];for(var a in e)n.push({title:a,dataIndex:a,key:a,width:100});return console.log(n),n}},{key:"showDrawer",value:function(){this.setState({drawerVisible:!0})}},{key:"closeDrawer",value:function(){this.setState({drawerVisible:!1})}},{key:"convertArg",value:function(){var e=[];for(var t in this.argInfo)e.push({argName:t,argVal:this.argInfo[t]});return e}},{key:"componentDidMount",value:function(){var e=this;A.allSql().then((function(t){e.setState({sqlList:t})})).catch((function(e){return k.a.error({message:e})})).finally((function(){return e.setState({sqlLoading:!1})}))}},{key:"render",value:function(){var e=this;return Object(f.jsxs)(f.Fragment,{children:[Object(f.jsxs)(y.a,{ref:this.form,children:[Object(f.jsx)(S.a,{showSearch:!0,allowClear:!0,placeholder:"sql",loading:this.state.sqlLoading,style:{width:240},onChange:function(t){return e.changeSql(t)},filterOption:function(e,t){return t.children.toLowerCase().indexOf(e.toLowerCase())>=0},children:this.state.sqlList.map((function(e){return Object(f.jsx)(J,{value:e.id,children:e.name},e.id)}))}),Object(f.jsx)(v.a,{onClick:function(){return e.execSql()},children:"exec"}),Object(f.jsx)(v.a,{onClick:function(){return e.showDrawer()},children:"\u5386\u53f2"}),this.state.sqlParam.map((function(t){return Object(f.jsxs)(I.a,{style:{marginTop:"2px"},children:[Object(f.jsx)(N.a,{span:4,children:t.argName}),Object(f.jsx)(N.a,{span:8,children:Object(f.jsx)(y.a.Item,{noStyle:!0,name:["arg",t.argName],children:Object(f.jsx)(g.a,{onChange:function(n){return e.argInfo[t.argName]=n.target.value}})})})]})})),Object(f.jsx)(Q.a,{style:{marginTop:"20px"},loading:this.state.tableLoading,columns:this.state.columns,dataSource:this.state.data,scroll:{x:800},sticky:!0})]}),Object(f.jsx)($.a,{width:520,title:"\u5386\u53f2\u8bb0\u5f55",placement:"right",closable:!0,onClose:function(){return e.closeDrawer()},visible:this.state.drawerVisible,children:Object(f.jsx)(R,{})})]})}}]),n}(o.a.Component),K=document.getElementById("root"),U=m.a.Header,z=m.a.Content,G=m.a.Footer,W=m.a.Sider,X=j.a.SubMenu,Y=function(e){Object(s.a)(n,e);var t=Object(i.a)(n);function n(){var e;Object(a.a)(this,n);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).state={collapsed:!1,path:[]},e.onCollapse=function(t){e.setState({collapsed:t})},e}return Object(r.a)(n,[{key:"menuClick",value:function(e,t,n,a){console.log([e,t,n,a]),this.setState({path:e.keyPath})}},{key:"render",value:function(){var e=this,t=this.state.collapsed;return Object(f.jsx)(d.a,{children:Object(f.jsxs)(m.a,{style:{minHeight:"100vh"},children:[Object(f.jsxs)(W,{collapsible:!0,collapsed:t,onCollapse:this.onCollapse,children:[Object(f.jsx)("div",{className:"logo"}),Object(f.jsxs)(j.a,{onClick:function(t){return e.menuClick(t)},theme:"dark",defaultSelectedKeys:["1"],mode:"inline",children:[Object(f.jsx)(j.a.Item,{icon:Object(f.jsx)(p.a,{}),children:"Option 1"},"1"),Object(f.jsxs)(X,{icon:Object(f.jsx)(x.a,{}),title:"Operation",children:[Object(f.jsx)(j.a.Item,{children:Object(f.jsx)(d.b,{to:"/data",children:"table data"})},"table_data"),Object(f.jsx)(j.a.Item,{children:Object(f.jsx)(d.b,{to:"/mysql-editor",children:"sql editor"})},"sql_editor")]},"op1")]})]}),Object(f.jsxs)(m.a,{className:"site-layout",children:[Object(f.jsx)(U,{className:"site-layout-background",style:{padding:0}}),Object(f.jsxs)(z,{style:{margin:"0 16px"},children:[Object(f.jsx)(b.a,{style:{margin:"16px 0"},children:this.state.path.map((function(e){return Object(f.jsx)(b.a.Item,{children:e})}))}),Object(f.jsxs)(h.c,{children:[Object(f.jsx)(h.a,{path:"/data",children:Object(f.jsx)(_,{})}),Object(f.jsx)(h.a,{path:"/mysql-editor",children:Object(f.jsx)(E,{})})]})]}),Object(f.jsx)(G,{style:{textAlign:"center"},children:"Err finder"})]})]})})}}]),n}(o.a.Component);u.a.render(Object(f.jsx)(Y,{}),K)}},[[272,1,2]]]);
//# sourceMappingURL=main.92da29e4.chunk.js.map